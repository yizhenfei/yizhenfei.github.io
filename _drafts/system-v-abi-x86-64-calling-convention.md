---
layout: post
title: "System V ABI x86-64 调用约定"
categories: infra
---
## 起因
在研究 ucontext 的实现过程中，发现涉及到不少于调用约定 (calling convention) 有关的知识，大学汇编课程中学习的是8086实模式相关的知识，并且印象已经模糊。工作后偶有需要查看x86-64汇编的情况，但没有做过系统的学习和梳理，因此写下这篇整理性质的博客，主要描述 System V x86-64 调用约定的相关内容，这也是 Linux 下 gcc 编译器生成代码时默认使用的调用约定。

## 什么是调用约定？
粗略来说，调用约定包含3个方面的内容：
1. 调用者 (caller) 如何向被调用者 (callee) 传递参数以及返回地址。
2. 被调用者如何向调用者传递返回值。
3. 调用者的哪些寄存器状态需要被调用者保持 (preserve)。

C 等高级语言对调用约定的概念进行了弱化，如果只是进行普通的应用级开发，则基本不需要知道相关知识，编译器会为你处理好一切。但是如果要进行系统级开发，比如说不同的高级语言、高级语言与汇编语言之间的互相调用等，就需要了解相关知识。

## 调用栈布局

